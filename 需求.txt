ğŸ“ã€éœ€æ±‚ä¸æ¶æ„è®¾è®¡æ–‡æ¡£ã€‘(å¾®ä¿¡åŠŸèƒ½ç²¾ç®€ç‰ˆ)
â–  æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

ç”¨æˆ·ç®¡ç†

æ‰‹æœºå·æ³¨å†Œ/ç™»å½•(JWTè®¤è¯)
ä¸ªäººä¿¡æ¯ç»´æŠ¤(æ˜µç§°/å¤´åƒ/çŠ¶æ€)
å¥½å‹ç³»ç»Ÿ

æœç´¢æ·»åŠ (ID/æ‰‹æœºå·)
äºŒç»´ç ç”Ÿæˆä¸æ‰«æ
å¥½å‹å…³ç³»åŒå‘éªŒè¯
ç§èŠåŠŸèƒ½

å®æ—¶æ¶ˆæ¯(æ–‡æœ¬/å›¾ç‰‡/è¯­éŸ³)
æ¶ˆæ¯çŠ¶æ€è¿½è¸ª(å·²é€è¾¾/å·²è¯»)
ä¼šè¯ç®¡ç†(ç½®é¡¶/å…æ‰“æ‰°)
é™Œç”ŸäººåŒ¹é…

éšæœºæ¨èç®—æ³•
åŒç›²è¿æ¥æœºåˆ¶(éœ€åŒæ–¹ç¡®è®¤)
24å°æ—¶ä¸´æ—¶ä¼šè¯
ç¾¤èŠç³»ç»Ÿ

åˆ›å»º/è§£æ•£ç¾¤ç»„(â‰¤200äºº)
æˆå‘˜æƒé™ç®¡ç†
ç¾¤æ¶ˆæ¯å¹¿æ’­
==============================================
ğŸ—ã€æŠ€æœ¯æ¶æ„è®¾è®¡ã€‘(è½»é‡çº§å•æœºæ–¹æ¡ˆ)
â–  æ¶æ„ç‰¹ç‚¹

â—‰ ç»„ä»¶ä¾èµ–

ä¸­é—´ä»¶: SQLite(åµŒå…¥å¼)
é€šä¿¡: WebSocket(åŸç”Ÿ)+HTTP
è¯­è¨€: Java 21(å†…ç½®å¹¶å‘åº“)
â—‰ å­˜å‚¨: å•æ–‡ä»¶æ•°æ®åº“æ¨¡å¼
â–  æ¨¡å—åˆ†å±‚

ç½‘ç»œå±‚

WebSocketæ¶ˆæ¯é€šé“
HTTP RESTful API(ç”¨æˆ·/å¥½å‹ç®¡ç†)
ä¸šåŠ¡é€»è¾‘å±‚

â”œâ”€â”€ ç”¨æˆ·æœåŠ¡(UserService)

â”œâ”€â”€ å¥½å‹æœåŠ¡(FriendService)

â”œâ”€â”€ èŠå¤©æœåŠ¡(ChatService)

â”œâ”€â”€ åŒ¹é…æœåŠ¡(MatchService)

â””â”€â”€ ç¾¤ç»„æœåŠ¡(GroupService)

æŒä¹…å±‚

JDBCç›´è¿SQLite
åˆ†è¡¨ç­–ç•¥:
ç”¨æˆ·è¡¨(users)
å¥½å‹è¡¨(friendships)
æ¶ˆæ¯è¡¨(messages_{month})
ç¾¤ç»„è¡¨(groups)
â–  å…³é”®æ•°æ®ç»“æ„(SQLite)

-- ç”¨æˆ·è¡¨

CREATE TABLE users (

id INTEGER PRIMARY KEY AUTOINCREMENT,

phone TEXT UNIQUE NOT NULL,

password TEXT NOT NULL,

nickname TEXT DEFAULT 'ç”¨æˆ·',

avatar TEXT,

status INT DEFAULT 0  -- 0=ç¦»çº¿,1=åœ¨çº¿

);

-- å¥½å‹å…³ç³»è¡¨

CREATE TABLE friendships (

user_a INT NOT NULL,

user_b INT NOT NULL,

status INT NOT NULL, -- 0=è¯·æ±‚ä¸­,1=å·²å¥½å‹

remark TEXT,

created_at BIGINT,

PRIMARY KEY (user_a, user_b)

);

-- æ¶ˆæ¯è¡¨(æŒ‰æœˆåˆ†è¡¨)

CREATE TABLE messages_202405 (

id INTEGER PRIMARY KEY AUTOINCREMENT,

sender INT NOT NULL,

receiver INT NOT NULL, -- ä¸ªäººIDæˆ–ç¾¤ID

type INT NOT NULL,     -- 0=ç§èŠ,1=ç¾¤èŠ

content TEXT NOT NULL,

status INT DEFAULT 0,  -- 0=æœªé€è¾¾,1=å·²é€è¾¾,2=å·²è¯»

timestamp BIGINT

);

-- ç¾¤ç»„è¡¨

CREATE TABLE groups (

id INTEGER PRIMARY KEY AUTOINCREMENT,

name TEXT NOT NULL,

owner INT NOT NULL,

create_time BIGINT

);

-- ç¾¤æˆå‘˜è¡¨

CREATE TABLE group_members (

group_id INT NOT NULL,

user_id INT NOT NULL,

role INT DEFAULT 0,  -- 0=æˆå‘˜,1=ç®¡ç†å‘˜

PRIMARY KEY (group_id, user_id)

);

==============================================
ğŸ”Œã€æ¥å£è§„èŒƒã€‘(æ ¸å¿ƒç¤ºä¾‹)
â–  UserService

POST /register

{ "phone": "13800138000", "password": "****"}

POST /login â†’ è¿”å›{ token: "jwt_string" }

â–  FriendService

POST /friends/request

{ "from":1001, "to":1002 } â†’ è§¦å‘å¥½å‹ç”³è¯·

POST /friends/approve

{ "requestId": 5001, "action":"accept" }

â–  ChatService

WS /chat â†’ æ¶ˆæ¯æ ¼å¼:

{

"type": "text/voice/img",

"from": 1001,

"to": 2002,     // ä¸ªäººIDæˆ–ç¾¤ID

"content": "hello",

"timestamp": 1715589000

}

â–  MatchService

POST /match/random â†’ è¿”å›{ userId: 1003 }

POST /match/confirm/{userId} â†’ å»ºç«‹ä¸´æ—¶ä¼šè¯

â–  GroupService

POST /groups/create

{ "name": "æŠ€æœ¯åˆ†äº«", "members": [1001,1002] }

POST /groups/{groupId}/invite

{ "userId": 1005 }

==============================================
âš¡ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‘
æ¶ˆæ¯æ‰¹å¤„ç† - æ¯100msæ‰¹é‡å…¥åº“
è¿æ¥ç®¡ç† - ä½¿ç”¨WeakHashMapç»´æŠ¤åœ¨çº¿session
SQLiteä¼˜åŒ–ï¼š
PRAGMA journal_mode=WAL;
æ¶ˆæ¯è¡¨æŒ‰æ—¶é—´åˆ†åŒº
èµ„æºæ¸…ç† - å®šæ—¶æ¸…é™¤24å°æ—¶æœªæ´»åŠ¨ä¸´æ—¶ä¼šè¯
==============================================
ğŸš€ã€éƒ¨ç½²æ–¹æ¡ˆã€‘
å¯åŠ¨å‘½ä»¤ï¼š

java -Xms128m -Xmx256m -jar wechat-core.jar

ç›‘æ§æŒ‡æ ‡ï¼š

åœ¨çº¿ç”¨æˆ·æ•°: JVMå†…ç½®ç›‘æ§
æ¶ˆæ¯åå: æ—¥å¿—ç»Ÿè®¡QPS
æ‰©å±•è·¯å¾„ï¼š

ç”¨æˆ·é‡>1ä¸‡ â†’ å¢åŠ Redisç¼“å­˜æ¶ˆæ¯è·¯ç”±è¡¨

ä¿å­˜æ–‡ä»¶å: wechat_system_design_v1.txt
